# Load necessary libraries
library(ggplot2)
library(car)
library(MASS)
# Load the dataset
data <- rio::import("raw/data_placeholder.csv", na.strings = c("", "NA"))   # set empty strings and "NA" as missing
data <- data %>%
# Ensure 'randomization' treated as factors
data$randomization <- as.factor(data$randomization)
# Load necessary libraries
library(ggplot2)
library(car)
library(MASS)
# Load the dataset
data <- rio::import("raw/data_placeholder.csv", na.strings = c("", "NA"))   # set empty strings and "NA" as missing
# Ensure 'randomization' treated as factors
data$randomization <- as.factor(data$randomization)
# Function to check normality
check_normality <- function(data, var_name) {
cat("\nNormality Check for", var_name, ":\n")
# Histogram
print(ggplot(data, aes_string(x = var_name)) +
geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
geom_density(color = "red") +
labs(title = paste("Histogram and Density Plot of", var_name)))
# Q-Q Plot
qqnorm(data[[var_name]], main = paste("Q-Q Plot of", var_name))
qqline(data[[var_name]], col = "red")
# Shapiro-Wilk Test
shapiro_test <- shapiro.test(data[[var_name]])
print(shapiro_test)
cat("Interpretation: If p-value > 0.05, data is normally distributed (qualifies for parametric testing).\n")
}
# Check normality for each variable
variables_to_check <- c("PedsQL_4w_total", "cdrisc_72", "cdrisc_4w", "calc_age")
for (var in variables_to_check) {
check_normality(data, var)
}
# clean_data_tool.R
# ---------------------
# Purpose: Clean raw data, perform EM imputation, compute change scores,
#          stratify by group, Winsorize variables, and save cleaned dataset.
# Language: R
# Dependencies: readr, dplyr, mice, psych, reshape2, ggplot2, MVN, DescTools, rio, car, MASS
# Notes: Replace "raw/data_placeholder.csv" with actual local data;
#        do not commit confidential data.
# Load necessary libraries
library(ggplot2)
library(car)
library(MASS)
library(rio)
# Load the dataset
data <- rio::import("raw/data_placeholder.csv", na.strings = c("", "NA"))   # set empty strings and "NA" as missing
# Ensure 'randomization' treated as factor
data$randomization <- as.factor(data$randomization)
# Function to check normality
check_normality <- function(data, var_name) {
cat("\nNormality Check for", var_name, ":\n")
# Histogram with density
print(ggplot(data, aes_string(x = var_name)) +
geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
geom_density(color = "red") +
labs(title = paste("Histogram and Density Plot of", var_name)))
# Q-Q Plot
qqnorm(data[[var_name]], main = paste("Q-Q Plot of", var_name))
qqline(data[[var_name]], col = "red")
# Shapiro-Wilk Test
shapiro_test <- shapiro.test(data[[var_name]])
print(shapiro_test)
cat("Interpretation: If p-value > 0.05, data is normally distributed (qualifies for parametric testing).\n")
}
# Function to apply Box-Cox transformation if variable is not normally distributed
apply_boxcox_if_needed <- function(data, var_name) {
shapiro_p <- shapiro.test(data[[var_name]])$p.value
if (shapiro_p <= 0.05) {
cat("\nTransforming", var_name, "to improve normality using Box-Cox transformation.\n")
# Box-Cox transformation
boxcox_result <- boxcox(lm(as.formula(paste(var_name, "~ 1")), data = data), lambda = seq(-3, 3, by = 0.1))
best_lambda <- boxcox_result$x[which.max(boxcox_result$y)]
cat("Best lambda for Box-Cox transformation:", best_lambda, "\n")
# Apply the transformation
transformed_var <- paste0(var_name, "_transformed")
if (best_lambda == 0) {
data[[transformed_var]] <- log(data[[var_name]])
} else {
data[[transformed_var]] <- (data[[var_name]]^best_lambda - 1) / best_lambda
}
# Re-check normality on transformed variable
check_normality(data, transformed_var)
}
return(data)
}
# List all numeric variables to check
numeric_vars <- names(data)[sapply(data, is.numeric)]
# Run normality checks for each numeric variable
for (var in numeric_vars) {
check_normality(data, var)
data <- apply_boxcox_if_needed(data, var)
}
# clean_data_tool.R
# ---------------------
# Purpose: Clean raw data, perform EM imputation, compute change scores,
#          stratify by group, Winsorize variables, and save cleaned dataset.
# Language: R
# Dependencies: readr, dplyr, mice, psych, reshape2, ggplot2, MVN, DescTools, rio, car, MASS
# Notes: Replace "raw/data_placeholder.csv" with actual local data;
#        do not commit confidential data.
# Load necessary libraries
library(ggplot2)
library(car)
library(MASS)
library(rio)
# Load the dataset
data <- rio::import("raw/data_placeholder.csv", na.strings = c("", "NA"))   # set empty strings and "NA" as missing
# Ensure 'randomization' treated as factor
data$randomization <- as.factor(data$randomization)
# Function to check normality
check_normality <- function(data, var_name) {
cat("\nNormality Check for", var_name, ":\n")
# Histogram with density
print(ggplot(data, aes_string(x = var_name)) +
geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
geom_density(color = "red") +
labs(title = paste("Histogram and Density Plot of", var_name)))
# Q-Q Plot
qqnorm(data[[var_name]], main = paste("Q-Q Plot of", var_name))
qqline(data[[var_name]], col = "red")
# Shapiro-Wilk Test
shapiro_test <- shapiro.test(data[[var_name]])
print(shapiro_test)
cat("Interpretation: If p-value > 0.05, data is normally distributed (qualifies for parametric testing).\n")
}
# Function to apply Box-Cox transformation if variable is not normally distributed
apply_boxcox_if_needed <- function(data, var_name) {
shapiro_p <- shapiro.test(data[[var_name]])$p.value
if (shapiro_p <= 0.05) {
cat("\nTransforming", var_name, "to improve normality using Box-Cox transformation.\n")
# Only keep positive values for Box-Cox
positive_data <- data[data[[var_name]] > 0, , drop = FALSE]
if (nrow(positive_data) < 2) {
cat("Not enough positive data to apply Box-Cox for", var_name, "\n")
return(data)
}
# Build formula and apply Box-Cox
formula_var <- as.formula(paste(var_name, "~ 1"))
boxcox_result <- boxcox(lm(formula_var, data = positive_data), lambda = seq(-3, 3, by = 0.1))
best_lambda <- boxcox_result$x[which.max(boxcox_result$y)]
cat("Best lambda for Box-Cox transformation:", best_lambda, "\n")
# Apply transformation to full dataset
transformed_var <- paste0(var_name, "_transformed")
if (best_lambda == 0) {
data[[transformed_var]] <- log(data[[var_name]])
} else {
data[[transformed_var]] <- (data[[var_name]]^best_lambda - 1) / best_lambda
}
# Re-check normality on transformed variable
check_normality(data, transformed_var)
}
return(data)
}
# List all numeric variables to check
numeric_vars <- names(data)[sapply(data, is.numeric)]
# Run normality checks for each numeric variable
for (var in numeric_vars) {
check_normality(data, var)
data <- apply_boxcox_if_needed(data, var)
}
# clean_data_tool.R
# ---------------------
# Purpose: Clean raw data, perform EM imputation, compute change scores,
#          stratify by group, Winsorize variables, and save cleaned dataset.
# Language: R
# Dependencies: readr, dplyr, mice, psych, reshape2, ggplot2, MVN, DescTools, rio, car, MASS
# Notes: Replace "raw/data_placeholder.csv" with actual local data;
#        do not commit confidential data.
# Load necessary libraries
library(ggplot2)
library(car)
library(MASS)
library(rio)
# Load the dataset
data <- rio::import("raw/data_placeholder.csv", na.strings = c("", "NA"))   # set empty strings and "NA" as missing
# Ensure 'randomization' treated as factor
data$randomization <- as.factor(data$randomization)
# Function to check normality
check_normality <- function(data, var_name) {
cat("\nNormality Check for", var_name, ":\n")
# Histogram with density
print(ggplot(data, aes_string(x = var_name)) +
geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
geom_density(color = "red") +
labs(title = paste("Histogram and Density Plot of", var_name)))
# Q-Q Plot
qqnorm(data[[var_name]], main = paste("Q-Q Plot of", var_name))
qqline(data[[var_name]], col = "red")
# Shapiro-Wilk Test
shapiro_test <- shapiro.test(data[[var_name]])
print(shapiro_test)
cat("Interpretation: If p-value > 0.05, data is normally distributed (qualifies for parametric testing).\n")
}
# Function to apply Box-Cox transformation if variable is not normally distributed
apply_boxcox_if_needed <- function(data, var_name) {
shapiro_p <- shapiro.test(data[[var_name]])$p.value
if (shapiro_p <= 0.05) {
cat("\nTransforming", var_name, "to improve normality using Box-Cox transformation.\n")
# Only keep positive values for Box-Cox
positive_values <- data[[var_name]] > 0
if (sum(positive_values) < 2) {
cat("Not enough positive data to apply Box-Cox for", var_name, "\n")
return(data)
}
# Create linear model with only positive values
lm_model <- lm(data[[var_name]][positive_values] ~ 1)
# Apply Box-Cox
boxcox_result <- MASS::boxcox(lm_model, lambda = seq(-3, 3, by = 0.1))
best_lambda <- boxcox_result$x[which.max(boxcox_result$y)]
cat("Best lambda for Box-Cox transformation:", best_lambda, "\n")
# Apply transformation to full dataset
transformed_var <- paste0(var_name, "_transformed")
if (best_lambda == 0) {
data[[transformed_var]] <- log(data[[var_name]])
} else {
data[[transformed_var]] <- (data[[var_name]]^best_lambda - 1) / best_lambda
}
# Re-check normality on transformed variable
check_normality(data, transformed_var)
}
return(data)
}
# List all numeric variables to check
numeric_vars <- names(data)[sapply(data, is.numeric)]
# Run normality checks for each numeric variable
for (var in numeric_vars) {
check_normality(data, var)
data <- apply_boxcox_if_needed(data, var)
}
# clean_data_tool.R
# ---------------------
# Purpose: Check normality, visualize distributions, apply Box-Cox transformations if needed,
#          and save updated dataset.
# Language: R
# Dependencies: ggplot2, MASS, rio
# Notes: Replace "raw/data_placeholder.csv" with actual local data; do not commit confidential data.
library(ggplot2)
library(MASS)
library(rio)
# Load the dataset
data <- rio::import("raw/data_placeholder.csv", na.strings = c("", "NA"))
# Function to check normality and visualize
check_normality <- function(df, var_name) {
cat("\nNormality Check for", var_name, ":\n")
# Histogram + density
print(
ggplot(df, aes_string(x = var_name)) +
geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
geom_density(color = "red") +
labs(title = paste("Histogram and Density of", var_name))
)
# Q-Q plot
qqnorm(df[[var_name]], main = paste("Q-Q Plot of", var_name))
qqline(df[[var_name]], col = "red")
# Shapiro-Wilk test
shapiro_test <- shapiro.test(df[[var_name]])
print(shapiro_test)
if (shapiro_test$p.value > 0.05) {
cat("Data appears normally distributed.\n")
} else {
cat("Data is NOT normally distributed.\n")
}
}
# Function to apply Box-Cox if variable is not normal
apply_boxcox <- function(df, var_name) {
shapiro_p <- shapiro.test(df[[var_name]])$p.value
if (shapiro_p <= 0.05) {
cat("\nApplying Box-Cox transformation to", var_name, "\n")
# Ensure positive values (required for Box-Cox)
if (any(df[[var_name]] <= 0)) {
df[[var_name]] <- df[[var_name]] + abs(min(df[[var_name]], na.rm = TRUE)) + 1
}
# Fit a simple intercept-only model
lm_model <- lm(df[[var_name]] ~ 1)
# Box-Cox
bc <- boxcox(lm_model, lambda = seq(-3, 3, 0.1), plotit = FALSE)
best_lambda <- bc$x[which.max(bc$y)]
cat("Best lambda:", best_lambda, "\n")
# Apply transformation
transformed_var <- paste0(var_name, "_transformed")
if (best_lambda == 0) {
df[[transformed_var]] <- log(df[[var_name]])
} else {
df[[transformed_var]] <- (df[[var_name]]^best_lambda - 1)/best_lambda
}
# Re-check normality
check_normality(df, transformed_var)
}
return(df)
}
# Loop through all numeric variables
numeric_vars <- names(data)[sapply(data, is.numeric)]
for (var in numeric_vars) {
check_normality(data, var)
data <- apply_boxcox(data, var)
}
# clean_data_tool.R
# ---------------------
# Purpose: Check normality, visualize distributions, apply Box-Cox transformations if needed,
#          and save updated dataset.
# Language: R
# Dependencies: ggplot2, MASS, rio
# Notes: Replace "raw/data_placeholder.csv" with actual local data; do not commit confidential data.
library(ggplot2)
library(MASS)
library(rio)
# Load the dataset
data <- rio::import("raw/data_placeholder.csv", na.strings = c("", "NA"))
# Identify numeric variables to check for normality, excluding 'randomization'
variables_to_check <- names(data)[sapply(data, is.numeric)]
# Function to check normality and visualize
check_normality <- function(df, var_name) {
cat("\nNormality Check for", var_name, ":\n")
# Histogram + density
print(
ggplot(df, aes_string(x = var_name)) +
geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
geom_density(color = "red") +
labs(title = paste("Histogram and Density of", var_name))
)
# Q-Q plot
qqnorm(df[[var_name]], main = paste("Q-Q Plot of", var_name))
qqline(df[[var_name]], col = "red")
# Shapiro-Wilk test
shapiro_test <- shapiro.test(df[[var_name]])
print(shapiro_test)
if (shapiro_test$p.value > 0.05) {
cat("Data appears normally distributed.\n")
} else {
cat("Data is NOT normally distributed.\n")
}
}
# Function to apply Box-Cox if variable is not normal
apply_boxcox <- function(df, var_name) {
shapiro_p <- shapiro.test(df[[var_name]])$p.value
if (shapiro_p <= 0.05) {
cat("\nApplying Box-Cox transformation to", var_name, "\n")
# Ensure positive values (required for Box-Cox)
if (any(df[[var_name]] <= 0)) {
df[[var_name]] <- df[[var_name]] + abs(min(df[[var_name]], na.rm = TRUE)) + 1
}
# Fit a simple intercept-only model
lm_model <- lm(df[[var_name]] ~ 1)
# Box-Cox
bc <- boxcox(lm_model, lambda = seq(-3, 3, 0.1), plotit = FALSE)
best_lambda <- bc$x[which.max(bc$y)]
cat("Best lambda:", best_lambda, "\n")
# Apply transformation
transformed_var <- paste0(var_name, "_transformed")
if (best_lambda == 0) {
df[[transformed_var]] <- log(df[[var_name]])
} else {
df[[transformed_var]] <- (df[[var_name]]^best_lambda - 1)/best_lambda
}
# Re-check normality
check_normality(df, transformed_var)
}
return(df)
}
# Loop through all numeric variables
numeric_vars <- names(data)[sapply(data, is.numeric)]
for (var in numeric_vars) {
check_normality(data, var)
data <- apply_boxcox(data, var)
}
# clean_data_tool.R
# ---------------------
# Purpose: Check normality, visualize distributions, apply Box-Cox transformations if needed,
#          and save updated dataset.
# Language: R
# Dependencies: ggplot2, MASS, rio
# Notes: Replace "raw/data_placeholder.csv" with actual local data; do not commit confidential data.
library(ggplot2)
library(MASS)
library(rio)
# Load the dataset
data <- rio::import("raw/data_placeholder.csv", na.strings = c("", "NA"))
# Identify numeric variables to check for normality, excluding 'randomization'
variables_to_check <- names(data)[sapply(data, is.numeric) & names(data) != "randomization"]
# Function to check normality and visualize
check_normality <- function(df, var_name) {
cat("\nNormality Check for", var_name, ":\n")
# Histogram + density
print(
ggplot(df, aes_string(x = var_name)) +
geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
geom_density(color = "red") +
labs(title = paste("Histogram and Density of", var_name))
)
# Q-Q plot
qqnorm(df[[var_name]], main = paste("Q-Q Plot of", var_name))
qqline(df[[var_name]], col = "red")
# Shapiro-Wilk test
shapiro_test <- shapiro.test(df[[var_name]])
print(shapiro_test)
if (shapiro_test$p.value > 0.05) {
cat("Data appears normally distributed.\n")
} else {
cat("Data is NOT normally distributed.\n")
}
}
# Function to apply Box-Cox if variable is not normal
apply_boxcox <- function(df, var_name) {
shapiro_p <- shapiro.test(df[[var_name]])$p.value
if (shapiro_p <= 0.05) {
cat("\nApplying Box-Cox transformation to", var_name, "\n")
# Ensure positive values (required for Box-Cox)
if (any(df[[var_name]] <= 0)) {
df[[var_name]] <- df[[var_name]] + abs(min(df[[var_name]], na.rm = TRUE)) + 1
}
# Fit a simple intercept-only model
lm_model <- lm(df[[var_name]] ~ 1)
# Box-Cox
bc <- boxcox(lm_model, lambda = seq(-3, 3, 0.1), plotit = FALSE)
best_lambda <- bc$x[which.max(bc$y)]
cat("Best lambda:", best_lambda, "\n")
# Apply transformation
transformed_var <- paste0(var_name, "_transformed")
if (best_lambda == 0) {
df[[transformed_var]] <- log(df[[var_name]])
} else {
df[[transformed_var]] <- (df[[var_name]]^best_lambda - 1)/best_lambda
}
# Re-check normality
check_normality(df, transformed_var)
}
return(df)
}
# Loop through all numeric variables
numeric_vars <- names(data)[sapply(data, is.numeric)]
for (var in numeric_vars) {
check_normality(data, var)
data <- apply_boxcox(data, var)
}
# clean_data_normality.R
# ---------------------
# Purpose: Check normality for all numeric variables (except randomization), generate histograms with density,
#          Q-Q plots, run Shapiro-Wilk tests, apply Box-Cox transformations if needed,
#          re-check normality, and save updated dataset.
# Language: R
# Dependencies: ggplot2, car, MASS, rio
# Notes: Replace "raw/data_placeholder.csv" with your actual data; do not commit confidential data.
# Load necessary libraries
library(ggplot2)
library(car)
library(MASS)
library(rio)
# Load the dataset
data <- import("raw/data_placeholder.csv", na.strings = c("", "NA"))  # set empty strings and "NA" as missing
# Ensure 'randomization' is treated as factor
if("randomization" %in% names(data)) data$randomization <- as.factor(data$randomization)
# Function to check normality: histogram + density + Q-Q plot + Shapiro-Wilk test
check_normality <- function(data, var_name) {
cat("\nNormality Check for", var_name, ":\n")
# Histogram with density
print(
ggplot(data, aes_string(x = var_name)) +
geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
geom_density(color = "red") +
labs(title = paste("Histogram and Density of", var_name))
)
# Q-Q Plot
qqnorm(data[[var_name]], main = paste("Q-Q Plot of", var_name))
qqline(data[[var_name]], col = "red")
# Shapiro-Wilk Test
shapiro_test <- shapiro.test(data[[var_name]])
print(shapiro_test)
cat("Interpretation: If p-value > 0.05, data is normally distributed (suitable for parametric testing).\n")
}
# Identify numeric variables, excluding 'randomization'
variables_to_check <- names(data)[sapply(data, is.numeric) & names(data) != "randomization"]
# Loop over each variable
for (var in variables_to_check) {
# Check normality
check_normality(data, var)
# Apply Box-Cox transformation if not normally distributed
if (shapiro.test(data[[var]])$p.value <= 0.05) {
cat("\nTransforming", var, "to improve normality using Box-Cox transformation.\n")
# Prepare intercept-only model for Box-Cox
formula_var <- as.formula(paste(var, "~ 1"))
boxcox_result <- boxcox(lm(formula_var, data = data), lambda = seq(-3, 3, by = 0.1))
best_lambda <- boxcox_result$x[which.max(boxcox_result$y)]
cat("Best lambda for Box-Cox transformation:", best_lambda, "\n")
# Apply the transformation
if (best_lambda == 0) {
data[[paste0(var, "_transformed")]] <- log(data[[var]])
} else {
data[[paste0(var, "_transformed")]] <- (data[[var]]^best_lambda - 1) / best_lambda
}
# Re-check normality on transformed variable
check_normality(data, paste0(var, "_transformed"))
}
}
# Save the updated dataset
export(data, "output/data_cleaned.csv")
cat("\nUpdated dataset saved to 'output/data_cleaned.csv'.\n")
